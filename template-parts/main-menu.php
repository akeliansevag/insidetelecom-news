<?php
$menu = wp_get_nav_menu_items('main-menu');
?>
<?php
$menu_name = 'main-menu';
$menuitems = wp_get_nav_menu_items($menu_name);
?>
<!-- Navigation -->
<header class="nav">
    <div class="nav__holder nav--sticky">
        <div class="container relative">
            <div class="flex-parent">

                <!-- Side Menu Button -->
                <button class="nav-icon-toggle" id="nav-icon-toggle" aria-label="Open side menu">
                    <span class="nav-icon-toggle__box">
                        <span class="nav-icon-toggle__inner"></span>
                    </span>
                </button>

                <!-- Logo -->
                <a href="<?= home_url() ?>" class="logo">
                    <!-- <img class="logo__img" src="<?= get_template_directory_uri() ?>/img/logo_default.png" alt="logo"> -->
                    <svg width="200" viewBox="0 0 297 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 37.4011L3.27197 12.6445H11.8566L8.58464 37.4011H0Z" fill="white" />
                        <path d="M12.4266 5.18481C12.4266 7.95084 10.2206 10.3696 7.69539 10.3696C5.17016 10.3696 2.65063 7.95084 2.65063 5.18481C2.65063 2.41878 4.85665 0 7.69539 0C10.5341 0 12.4266 2.41279 12.4266 5.18481Z" fill="white" />
                        <path d="M73.568 5.18481C73.568 7.95084 71.362 10.3696 68.8367 10.3696C66.3115 10.3696 63.792 7.95084 63.792 5.18481C63.792 2.41878 65.998 0 68.8367 0C71.6755 0 73.568 2.41279 73.568 5.18481Z" fill="white" />
                        <path d="M21.3876 17.2787C24.8305 13.7224 28.3419 11.9502 31.9217 11.9502C33.9396 11.9502 35.5243 12.5609 36.6644 13.7942C37.8044 15.0216 38.2091 16.7698 37.8956 19.0269L35.4274 37.4073H26.7971L28.8835 21.8648C29.0089 20.9368 28.969 20.3141 28.7637 19.9968C28.5642 19.6795 28.131 19.5538 27.4584 19.6196C25.9706 19.6496 24.1123 20.5955 21.8664 22.4575L19.8713 37.4013H11.2354L14.513 12.6447H21.2964L21.3876 17.2787Z" fill="white" />
                        <path d="M44.2969 26.7382C40.4037 25.3432 38.7335 22.6191 39.2693 18.5718C39.5543 16.2787 40.5177 14.6024 42.165 13.5367C43.8124 12.4829 46.5144 11.9441 50.2766 11.9441C54.8311 12.0099 58.6389 12.3752 61.7056 13.0457L60.9475 18.476C56.8376 18.4101 53.7993 18.3802 51.8384 18.3802C50.0371 18.3802 48.8686 18.4281 48.3328 18.5299C47.7969 18.6257 47.4948 18.8831 47.4321 19.2783C47.4036 19.6734 47.5518 19.9907 47.8824 20.2242C48.213 20.4577 48.8686 20.7451 49.849 21.0684L55.3042 22.9124C59.1918 24.2416 60.9133 26.798 60.4744 30.5819C60.1267 33.5395 59.0322 35.5092 57.1967 36.4851C55.3669 37.467 52.5339 37.958 48.7147 37.958C44.8955 37.958 41.2245 37.6227 37.4281 36.9581L38.1349 31.5278C38.5169 31.5278 39.6569 31.5338 41.5494 31.5578C43.4476 31.5697 44.8898 31.5757 45.8645 31.5757C48.424 31.5757 50.1112 31.4979 50.915 31.3243C51.7244 31.1566 52.1577 30.8453 52.2204 30.3783C52.2489 30.0131 52.112 29.7257 51.7871 29.5281C51.4736 29.3306 50.7326 29.0372 49.564 28.6301L44.2969 26.7382Z" fill="white" />
                        <path d="M61.0388 37.4011L64.3108 12.6445H72.9011L69.6235 37.4011H61.0388Z" fill="white" />
                        <path d="M96.1354 37.4014H89.3577L89.2608 33.2164C86.0972 36.4015 83.019 38.0001 80.0149 38.0001C74.3603 38.0001 72.0972 33.4798 73.2316 24.4453C73.5451 21.9248 74.0125 19.8233 74.6282 18.1469C75.2495 16.4645 76.019 15.1893 76.9539 14.3092C77.8887 13.4351 78.8635 12.8124 79.8952 12.4712C80.9213 12.1179 82.1127 11.9443 83.475 11.9443C86.1599 11.9443 88.6908 12.1778 91.0621 12.6388C91.0621 10.687 91.1761 8.98667 91.3927 7.55576L92.2022 2.52661H100.832L96.1354 37.4014ZM87.1745 17.7697C85.3447 17.7697 84.1078 18.1589 83.475 18.9132C82.8423 19.6796 82.3578 21.4697 82.0044 24.2956C81.6566 26.5528 81.5597 28.1573 81.7193 29.1033C81.8789 30.0552 82.4604 30.4923 83.475 30.4204C85.0198 30.3905 86.7983 29.5224 88.7934 27.834L90.0703 17.7697H87.1745Z" fill="white" />
                        <path d="M122.174 36.0062C119.358 37.3353 115.756 37.9939 111.361 37.9939C106.493 37.9939 103.17 36.9102 101.403 34.7309C99.6355 32.5516 98.9856 29.2108 99.4531 24.6966C99.9946 19.7512 101.346 16.3865 103.512 14.6143C105.678 12.8302 109.007 11.9441 113.499 11.9441C117.99 11.9441 121.006 12.6805 122.648 14.1593C124.295 15.6381 124.911 17.8713 124.494 20.8589C124.181 23.086 123.275 24.6547 121.77 25.5647C120.271 26.4807 117.888 27.0675 114.633 27.3369L108.226 27.8278C108.26 29.0911 108.574 29.9293 109.172 30.3424C109.776 30.7555 110.791 30.965 112.21 30.965C115.209 30.965 118.344 30.7675 121.599 30.3663L122.169 36.0002L122.174 36.0062ZM112.735 22.655C113.903 22.5592 114.753 22.3317 115.271 21.9844C115.796 21.6312 116.104 20.9606 116.201 19.9608C116.263 19.1645 116.104 18.6436 115.722 18.3922C115.345 18.1467 114.553 18.0389 113.35 18.0749C111.891 18.1048 110.859 18.4461 110.244 19.0987C109.628 19.7453 109.126 21.0624 108.75 23.0501L112.735 22.655Z" fill="white" />
                        <path d="M139.115 28.756C138.99 29.5522 139.036 30.0731 139.252 30.3246C139.469 30.57 139.993 30.6958 140.814 30.6958H143.744L144.172 36.7068C142.348 37.4372 139.931 37.7964 136.938 37.7964C134.607 37.7964 132.839 37.1498 131.62 35.8686C130.411 34.5754 129.955 32.8332 130.274 30.6479L132.024 18.1349H127.909L128.57 12.7285L132.822 12.4771L133.769 5.82544H142.228L141.333 12.4771H147.335L146.577 18.1349H140.523L139.11 28.7619L139.115 28.756Z" fill="white" />
                        <path d="M168.33 35.7547C165.525 37.0779 161.934 37.7484 157.55 37.7484C152.694 37.7484 149.388 36.6588 147.626 34.4915C145.859 32.3241 145.215 28.9893 145.688 24.493C146.224 19.5597 147.569 16.2009 149.73 14.4347C151.884 12.6626 155.202 11.7825 159.677 11.7825C164.151 11.7825 167.161 12.5189 168.803 13.9917C170.433 15.4705 171.054 17.6917 170.644 20.6673C170.33 22.8945 169.424 24.4511 167.925 25.3612C166.426 26.2772 164.054 26.8579 160.811 27.1214L154.427 27.6243C154.449 28.8816 154.769 29.7258 155.367 30.1329C155.971 30.546 156.975 30.7495 158.394 30.7495C161.392 30.7495 164.51 30.552 167.754 30.1568L168.324 35.7667L168.33 35.7547ZM158.924 22.4514C160.093 22.3497 160.936 22.1281 161.455 21.7809C161.974 21.4396 162.282 20.7631 162.378 19.7692C162.441 18.973 162.282 18.4581 161.905 18.2066C161.529 17.9552 160.737 17.8534 159.54 17.8833C158.092 17.9132 157.054 18.2545 156.439 18.9011C155.829 19.5477 155.333 20.8649 154.957 22.8526L158.93 22.4514H158.924Z" fill="white" />
                        <path d="M179.394 28.756C179.269 29.5224 179.337 30.0313 179.611 30.2947C179.873 30.5641 180.466 30.6958 181.383 30.6958H183.367L183.84 36.7548C182.546 37.4493 180.483 37.7965 177.644 37.7965C175.221 37.7965 173.375 37.1679 172.115 35.9106C170.855 34.6533 170.348 32.929 170.604 30.7437L174.435 2.38892H182.991L179.4 28.756H179.394Z" fill="white" />
                        <path d="M206.903 35.7547C204.099 37.0779 200.508 37.7484 196.124 37.7484C191.268 37.7484 187.967 36.6588 186.2 34.4915C184.433 32.3241 183.789 28.9893 184.268 24.493C184.803 19.5597 186.149 16.2009 188.303 14.4347C190.464 12.6626 193.787 11.7825 198.256 11.7825C202.725 11.7825 205.741 12.5189 207.382 13.9917C209.018 15.4705 209.628 17.6917 209.229 20.6673C208.91 22.8945 208.004 24.4511 206.504 25.3612C205.011 26.2772 202.64 26.8579 199.391 27.1214L193.012 27.6243C193.035 28.8816 193.354 29.7258 193.947 30.1329C194.551 30.546 195.56 30.7495 196.979 30.7495C199.978 30.7495 203.096 30.552 206.333 30.1568L206.903 35.7667V35.7547ZM197.498 22.4514C198.661 22.3497 199.51 22.1281 200.023 21.7809C200.548 21.4396 200.85 20.7631 200.947 19.7692C201.009 18.973 200.85 18.4581 200.474 18.2066C200.092 17.9552 199.305 17.8534 198.108 17.8833C196.66 17.9132 195.623 18.2545 195.007 18.9011C194.397 19.5477 193.901 20.8649 193.525 22.8526L197.498 22.4514Z" fill="white" />
                        <path d="M229.927 35.9524C227.311 37.1439 224.033 37.7426 220.094 37.7426C215.836 37.7426 212.792 36.6889 210.945 34.5874C209.098 32.4859 208.494 29.1032 209.121 24.4333C209.719 19.8652 210.991 16.6142 212.929 14.6803C214.867 12.7465 217.956 11.7766 222.214 11.7766C226.216 11.7766 229.545 12.3753 232.19 13.5667L231.01 19.0749L223.303 19.027C221.542 19.027 220.293 19.4281 219.564 20.2184C218.846 21.0147 218.333 22.5174 218.059 24.7386C217.74 27.1574 217.831 28.72 218.321 29.4505C218.8 30.1809 219.917 30.5401 221.65 30.5401C224.58 30.5401 227.128 30.4144 229.306 30.145L229.916 35.9524H229.927Z" fill="white" />
                        <path d="M254.797 14.8779C256.627 16.9435 257.208 20.38 256.547 25.1817C255.914 29.8217 254.569 33.0727 252.506 34.9406C250.442 36.8086 247.17 37.7486 242.696 37.7486C238.221 37.7486 234.903 36.7248 233.022 34.6712C231.152 32.6236 230.537 29.223 231.204 24.4872C231.836 19.7873 233.176 16.4944 235.228 14.6085C237.275 12.7226 240.586 11.7766 245.152 11.7766C249.718 11.7766 252.973 12.8064 254.797 14.8779ZM241.704 19.494C241.071 20.41 240.552 22.3019 240.136 25.1817C239.794 27.7322 239.805 29.4146 240.17 30.2168C240.524 31.0311 241.47 31.4382 242.981 31.4382C244.491 31.4382 245.523 30.9772 246.156 30.0492C246.788 29.1212 247.29 27.2652 247.666 24.4812C248.042 21.9008 248.059 20.2004 247.712 19.3742C247.37 18.548 246.475 18.1349 245.021 18.1349C243.437 18.1349 242.342 18.5839 241.709 19.494" fill="white" />
                        <path d="M266.665 16.3868C269.629 13.3094 272.599 11.7708 275.598 11.7708C278.91 11.7708 280.882 13.1119 281.509 15.7941C284.194 13.1119 286.964 11.7708 289.831 11.7708C292.072 11.7708 293.713 12.3934 294.773 13.6327C295.834 14.8721 296.221 16.6023 295.931 18.8235L293.474 37.144H284.963L287.044 21.3501C287.203 20.0569 286.776 19.4103 285.767 19.4103C284.564 19.4103 283.042 20.2245 281.178 21.847L279.143 37.138H270.872L272.953 21.3441C273.084 20.6197 273.05 20.1108 272.862 19.8294C272.673 19.554 272.292 19.4043 271.727 19.4043C270.53 19.4043 268.985 20.1706 267.087 21.6913L265.058 37.138H256.502L259.814 12.4593H266.472L266.665 16.3808V16.3868Z" fill="white" />
                    </svg>

                </a>

                <nav class="flex-child nav__wrap d-none d-lg-block">
                    <ul class="nav__menu">
                        <?php
                        $count = 0;
                        $submenu = false;
                        foreach ($menuitems as $item) :
                            // set up title and url
                            $title = $item->title;
                            $link = $item->url;

                            // item does not have a parent so menu_item_parent equals 0 (false)
                            if (!$item->menu_item_parent) :
                                // save this id for later comparison with sub-menu items
                                $parent_id = $item->ID;
                        ?>
                                <li class="<?= $menuitems[$count + 1]->menu_item_parent == $parent_id ? 'nav__dropdown' : '' ?>">
                                    <a href="<?php echo $link; ?>" class="title">
                                        <?php echo $title; ?>
                                    </a>
                                <?php endif; ?>
                                <?php if ($parent_id == $item->menu_item_parent) : ?>
                                    <?php if (!$submenu) : $submenu = true; ?>
                                        <ul class="nav__dropdown-menu nav__megamenu">
                                            <li>
                                                <div class="nav__megamenu-wrap">
                                                    <div class="row">
                                                        <?php
                                                        $posts = new WP_Query([
                                                            'cat' => $item->object_id,
                                                            'posts_per_page' => 5,
                                                        ]);
                                                        $posts = $posts->posts;
                                                        ?>
                                                        <?php foreach ($posts as $p) : ?>
                                                            <div class="col nav__megamenu-item">
                                                                <article class="entry">
                                                                    <div class="entry__img-holder submenu-image-holder">
                                                                        <a href="<?= get_permalink($p->ID) ?>">
                                                                            <?= get_the_post_thumbnail($p->ID, 'small-thumb', ['class' => 'entry__img submenu-image']); ?>
                                                                        </a>
                                                                        <?php $cat = get_the_category($p->ID); ?>
                                                                        <a href="<?= get_category_link($cat[0]) ?>" class="entry__meta-category entry__meta-category--label entry__meta-category--align-in-corner entry__meta-category--violet"><?= $cat[0]->name; ?></a>
                                                                    </div>

                                                                    <div class="entry__body">
                                                                        <h2 class="entry__title">
                                                                            <a href="<?= get_permalink($p->ID) ?>"><?= $p->post_title; ?></a>
                                                                        </h2>
                                                                    </div>
                                                                </article>
                                                            </div>
                                                        <?php endforeach; ?>
                                                    </div>
                                                    <div class="mega-menu-links">
                                                    <?php endif; ?>
                                                    <a href="<?php echo $link; ?>" class="title"><?php echo $title; ?></a>
                                                    <?php if ($menuitems[$count + 1]->menu_item_parent != $parent_id && $submenu) : ?>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    <?php $submenu = false;
                                                    endif; ?>
                                <?php endif; ?>
                                <?php if ($menuitems[$count + 1]->menu_item_parent != $parent_id) : ?>
                                </li>
                            <?php $submenu = false;
                                endif; ?>
                        <?php $count++;
                        endforeach; ?>
                        <li>
                            <a href="<?= get_term_link(4357) ?>">SERIES</a>
                        </li>
                    </ul> <!-- end menu -->
                </nav> <!-- end nav-wrap -->


                <!-- Nav Right -->
                <div class="nav__right">

                    <!-- Search -->
                    <div class="nav__right-item nav__search">
                        <a href="#" class="nav__search-trigger" id="nav__search-trigger">
                            <i class="ui-search nav__search-trigger-icon"></i>
                        </a>
                        <div class="nav__search-box" id="nav__search-box">
                            <form class="nav__search-form" action="<?= home_url() ?>">
                                <input name="s" type="text" placeholder="Search an article" class="nav__search-input">
                                <button type="submit" class="search-button btn btn-lg btn-color btn-button">
                                    <i class="ui-search nav__search-icon"></i>
                                </button>
                            </form>
                        </div>
                    </div>

                </div> <!-- end nav right -->
            </div> <!-- end flex-parent -->
        </div> <!-- end container -->

    </div>
</header>